<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sfpermits.ai — San Francisco Building Permit Intelligence</title>
    <meta name="description" content="Free SF building permit lookup powered by 1.1M+ permits, 3.9M routing records, and AI analysis. See permit history, get timeline and fee estimates, and share project analysis with your contractor.">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#22D3EE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <link rel="stylesheet" href="/static/design-system.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/mobile.css">
    <style nonce="{{ csp_nonce }}">
        /* ── Landing Page Layout ─────────────────────────────────────────── */

        .landing-header {
            border-bottom: 1px solid rgba(255,255,255, 0.06);
            padding: var(--space-4) 0;
        }
        .landing-header .obs-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .landing-logo {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--signal-cyan);
            text-decoration: none;
        }
        .landing-logo .logo-dim { color: var(--text-tertiary); font-weight: 400; }
        .landing-header-actions { display: flex; align-items: center; gap: var(--space-2); }

        /* ── Hero Split ──────────────────────────────────────────────────── */

        .hero-section {
            background: var(--gradient-hero);
            padding: var(--space-16) 0 var(--space-12);
            position: relative;
            overflow: hidden;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(34,211,238,0.04) 0%, transparent 70%);
            pointer-events: none;
        }
        .hero-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-12);
            align-items: center;
        }
        .hero-content h1 {
            font-size: var(--text-3xl);
            font-weight: 700;
            margin-bottom: var(--space-4);
            color: var(--text-primary);
        }
        .hero-content h1 .cyan { color: var(--signal-cyan); }
        .hero-content .hero-sub {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            margin-bottom: var(--space-8);
            max-width: 500px;
            line-height: 1.6;
        }

        /* ── Search Bar ──────────────────────────────────────────────────── */

        .hero-search-form {
            display: flex;
            background: var(--bg-surface);
            border: 1px solid rgba(255,255,255, 0.08);
            border-radius: var(--card-radius);
            overflow: hidden;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .hero-search-form:focus-within {
            border-color: var(--signal-cyan);
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.12);
        }
        .hero-search-form input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: var(--text-base);
            padding: var(--space-4) var(--space-6);
            outline: none;
            min-width: 0;
        }
        .hero-search-form input::placeholder { color: var(--text-tertiary); }
        .hero-search-form button {
            background: var(--gradient-accent);
            border: none;
            color: #fff;
            font-family: var(--font-body);
            font-size: var(--text-base);
            font-weight: 600;
            padding: var(--space-4) var(--space-8);
            cursor: pointer;
            white-space: nowrap;
            transition: opacity 0.2s;
        }
        .hero-search-form button:hover { opacity: 0.9; }
        .search-suggestions {
            margin-top: var(--space-3);
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }
        .search-suggestions code {
            background: var(--bg-elevated);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: color 0.2s;
        }
        .search-suggestions code:hover { color: var(--signal-cyan); }

        /* ── Live Data Pulse Panel ───────────────────────────────────────── */

        .data-pulse {
            padding: var(--space-8);
        }
        .data-pulse-title {
            font-family: var(--font-mono);
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .pulse-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--signal-green);
            box-shadow: 0 0 6px rgba(52, 211, 153, 0.6);
        }
        .pulse-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
        }
        .pulse-stat-number {
            font-family: var(--font-display);
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--signal-cyan);
            line-height: 1;
        }
        .pulse-stat-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-top: var(--space-1);
        }
        .pulse-refresh {
            margin-top: var(--space-6);
            padding-top: var(--space-4);
            border-top: 1px solid rgba(255,255,255, 0.04);
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        /* ── Homeowner Funnel ────────────────────────────────────────────── */

        .funnel-section {
            padding: var(--space-12) 0;
            border-top: 1px solid rgba(255,255,255, 0.04);
        }
        .funnel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
        }
        .funnel-card {
            padding: var(--space-8);
        }
        .funnel-card h2 {
            font-size: var(--text-lg);
            margin-bottom: var(--space-2);
        }
        .funnel-card p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-6);
            line-height: 1.6;
        }
        .funnel-card.funnel-primary {
            border-color: rgba(34, 211, 238, 0.2);
        }
        .funnel-form textarea {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid rgba(255,255,255, 0.08);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: var(--text-sm);
            padding: var(--space-3) var(--space-4);
            resize: none;
            outline: none;
            margin-bottom: var(--space-3);
            transition: border-color 0.2s;
            min-height: 80px;
        }
        .funnel-form textarea:focus { border-color: var(--signal-cyan); }
        .funnel-form textarea::placeholder { color: var(--text-tertiary); }
        .funnel-form select {
            width: 100%;
            background: var(--bg-elevated);
            border: 1px solid rgba(255,255,255, 0.08);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: var(--font-body);
            font-size: var(--text-sm);
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-4);
            outline: none;
        }
        .funnel-form select:focus { border-color: var(--signal-cyan); color: var(--text-primary); }
        .funnel-violation-icon { font-size: 2.2rem; margin-bottom: var(--space-4); }
        .funnel-violation-cta {
            display: inline-block;
            border: 2px solid var(--signal-red);
            border-radius: 8px;
            color: var(--signal-red);
            font-size: var(--text-sm);
            font-weight: 600;
            padding: var(--space-3) var(--space-6);
            text-decoration: none;
            transition: background 0.2s, color 0.2s;
        }
        .funnel-violation-cta:hover {
            background: var(--signal-red);
            color: #fff;
        }

        /* ── Capability Cards ────────────────────────────────────────────── */

        .capabilities-section {
            padding: var(--space-12) 0;
        }
        .capabilities-section h2 {
            font-size: var(--text-xl);
            text-align: center;
            margin-bottom: var(--space-8);
            color: var(--text-primary);
        }
        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-6);
        }
        .capability-card {
            padding: var(--space-6);
            transition: border-color 0.3s;
        }
        .capability-card:hover {
            border-color: rgba(34, 211, 238, 0.15);
        }
        .capability-icon {
            font-size: 1.6rem;
            margin-bottom: var(--space-3);
        }
        .capability-card h3 {
            font-family: var(--font-body);
            font-size: var(--text-base);
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--text-primary);
        }
        .capability-card .capability-desc {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: var(--space-3);
        }
        .capability-data-point {
            font-family: var(--font-mono);
            font-size: var(--text-xs);
            color: var(--signal-cyan);
            margin-bottom: var(--space-3);
        }
        .capability-badge {
            display: inline-block;
            font-size: var(--text-xs);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        .capability-badge-free {
            background: rgba(52, 211, 153, 0.1);
            color: var(--signal-green);
        }
        .capability-badge-premium {
            background: rgba(96, 165, 250, 0.1);
            color: var(--signal-blue);
        }

        /* ── Stats Bar ───────────────────────────────────────────────────── */

        .stats-bar {
            border-top: 1px solid rgba(255,255,255, 0.04);
            padding: var(--space-10) 0;
        }
        .stats-bar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-6);
            text-align: center;
        }

        /* ── Credibility Footer ──────────────────────────────────────────── */

        .credibility-section {
            border-top: 1px solid rgba(255,255,255, 0.04);
            padding: var(--space-8) 0;
        }
        .credibility-grid {
            display: flex;
            justify-content: center;
            gap: var(--space-10);
            flex-wrap: wrap;
        }
        .credibility-item {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .credibility-item .cred-icon {
            color: var(--signal-cyan);
            font-size: 1rem;
        }

        /* ── CTA Section ─────────────────────────────────────────────────── */

        .cta-section {
            padding: var(--space-12) 0;
            text-align: center;
            background: rgba(34, 211, 238, 0.02);
            border-top: 1px solid rgba(255,255,255, 0.04);
            border-bottom: 1px solid rgba(255,255,255, 0.04);
        }
        .cta-section h2 {
            font-size: var(--text-xl);
            margin-bottom: var(--space-2);
        }
        .cta-section .cta-sub {
            color: var(--text-secondary);
            font-size: var(--text-base);
            max-width: 540px;
            margin: 0 auto var(--space-6);
        }
        .cta-features {
            display: flex;
            justify-content: center;
            gap: var(--space-6);
            margin-top: var(--space-4);
            flex-wrap: wrap;
        }
        .cta-features span {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        /* ── Footer ──────────────────────────────────────────────────────── */

        .landing-footer {
            border-top: 1px solid rgba(255,255,255, 0.04);
            padding: var(--space-6) 0;
            text-align: center;
        }
        .landing-footer p {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }

        /* ── Mobile: Phone (<=768px) ─────────────────────────────────────── */

        @media (max-width: 768px) {
            .hero-section {
                padding: var(--space-10) 0 var(--space-8);
            }
            .hero-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            .hero-content h1 {
                font-size: var(--text-2xl);
            }
            .hero-search-form {
                flex-direction: column;
            }
            .hero-search-form input {
                padding: var(--space-4);
            }
            .hero-search-form button {
                padding: var(--space-4);
                min-height: 48px;
            }
            .data-pulse {
                padding: var(--space-6);
            }
            .pulse-stats {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-4);
            }
            .funnel-grid {
                grid-template-columns: 1fr;
            }
            .funnel-card {
                padding: var(--space-6);
            }
            .capabilities-grid {
                grid-template-columns: 1fr;
                gap: var(--space-4);
                display: flex;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
                padding-bottom: var(--space-2);
            }
            .capabilities-grid::-webkit-scrollbar { display: none; }
            .capability-card {
                min-width: 260px;
                scroll-snap-align: start;
                flex-shrink: 0;
            }
            .stats-bar-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--space-4);
            }
            .credibility-grid {
                gap: var(--space-4);
                flex-direction: column;
                align-items: center;
            }
            .cta-features {
                flex-direction: column;
                align-items: center;
                gap: var(--space-2);
            }
        }

        /* ── Tablet (<=1024px) ───────────────────────────────────────────── */

        @media (max-width: 1024px) and (min-width: 769px) {
            .hero-grid {
                gap: var(--space-8);
            }
            .capabilities-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body class="obsidian">
{% if is_staging %}
<div id="staging-banner" style="background: var(--signal-amber); color: #0B0F19; text-align: center; padding: 8px 16px; font-size: 14px; font-weight: 600; letter-spacing: 0.02em; position: relative; z-index: 9999;">
  &#9888; STAGING ENVIRONMENT &mdash; changes here do not affect production
</div>
{% endif %}

    <!-- ── Header ────────────────────────────────────────────────────── -->
    <header class="landing-header">
        <div class="obs-container">
            <a href="/" class="landing-logo">sfpermits<span class="logo-dim">.ai</span></a>
            <div class="landing-header-actions">
                <a href="/auth/login" class="obsidian-btn obsidian-btn-outline">Sign in</a>
                <a href="/auth/login" class="obsidian-btn obsidian-btn-primary">Get started free</a>
            </div>
        </div>
    </header>

    <!-- ── Hero Split ────────────────────────────────────────────────── -->
    <section class="hero-section">
        <div class="obs-container">
            <div class="hero-grid">
                <div class="hero-content">
                    <h1>San Francisco<br><span class="cyan">Building Permit<br>Intelligence</span></h1>
                    <p class="hero-sub">Look up any SF address to see permit history, inspection results, and compliance status. Powered by 1.1M+ permits and AI analysis.</p>
                    <div class="hero-search">
                        <form class="hero-search-form" action="/search" method="GET">
                            <input type="text" name="q" placeholder="Enter an address, permit #, or block/lot..." autocomplete="off" autofocus>
                            <button type="submit">Search</button>
                        </form>
                        <div class="search-suggestions">
                            Try <code onclick="this.closest('form')||document.querySelector('.hero-search-form input').value='1455 Market St'">1455 Market St</code>
                            or <code onclick="document.querySelector('.hero-search-form input').value='Block 3506 Lot 007'">Block 3506 Lot 007</code>
                        </div>
                    </div>
                </div>
                <div class="glass-card data-pulse" id="data-pulse">
                    <div class="data-pulse-title">
                        <span class="pulse-dot"></span>
                        Live Data Pulse
                    </div>
                    <div class="pulse-stats">
                        <div>
                            <div class="pulse-stat-number" data-stat="permits">1,137,816</div>
                            <div class="pulse-stat-label">Permits tracked</div>
                        </div>
                        <div>
                            <div class="pulse-stat-number" data-stat="routing_records">3,920,710</div>
                            <div class="pulse-stat-label">Routing records</div>
                        </div>
                        <div>
                            <div class="pulse-stat-number" data-stat="entities">1,000,000</div>
                            <div class="pulse-stat-label">Entities mapped</div>
                        </div>
                        <div>
                            <div class="pulse-stat-number" data-stat="inspections">671,000</div>
                            <div class="pulse-stat-label">Inspections</div>
                        </div>
                    </div>
                    <div class="pulse-refresh">
                        <span data-stat="last_refresh">Updated nightly from SF open data</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ── Homeowner Funnel ──────────────────────────────────────────── -->
    <section class="funnel-section">
        <div class="obs-container">
            <div class="funnel-grid">
                <div class="glass-card funnel-card funnel-primary">
                    <h2>Planning a project?</h2>
                    <p>Describe your remodel and get an instant permit preview — what you'll need, OTC vs. in-house review, and how long it takes.</p>
                    <form class="funnel-form" action="/analyze-preview" method="POST">
                        <textarea name="description" rows="3" placeholder="e.g. Kitchen remodel in the Mission, moving the sink and adding an island..." required></textarea>
                        <select name="neighborhood">
                            <option value="">Neighborhood (optional)</option>
                            <option value="Mission">Mission</option>
                            <option value="Noe Valley">Noe Valley</option>
                            <option value="Castro/Upper Market">Castro / Upper Market</option>
                            <option value="Bernal Heights">Bernal Heights</option>
                            <option value="Pacific Heights">Pacific Heights</option>
                            <option value="Richmond">Richmond</option>
                            <option value="Sunset">Sunset</option>
                            <option value="SoMa">SoMa</option>
                            <option value="Potrero Hill">Potrero Hill</option>
                            <option value="Haight Ashbury">Haight Ashbury</option>
                            <option value="Marina">Marina</option>
                            <option value="North Beach">North Beach</option>
                            <option value="Chinatown">Chinatown</option>
                            <option value="Tenderloin">Tenderloin</option>
                            <option value="Bayview Hunters Point">Bayview / Hunters Point</option>
                            <option value="Excelsior">Excelsior</option>
                            <option value="Glen Park">Glen Park</option>
                            <option value="Visitacion Valley">Visitacion Valley</option>
                            <option value="Outer Sunset">Outer Sunset</option>
                        </select>
                        <button type="submit" class="obsidian-btn obsidian-btn-primary" style="width:100%;">Get free permit preview</button>
                    </form>
                </div>
                <div class="glass-card funnel-card" style="display:flex;flex-direction:column;justify-content:center;">
                    <div class="funnel-violation-icon">&#x26A0;&#xFE0F;</div>
                    <h2>Got a Notice of Violation?</h2>
                    <p>Look up your property to see open complaints, enforcement actions, and what steps come next.</p>
                    <a href="/search?context=violation" class="funnel-violation-cta">Look up your property</a>
                </div>
            </div>
        </div>
    </section>

    <!-- ── Capability Cards ──────────────────────────────────────────── -->
    <section class="capabilities-section">
        <div class="obs-container">
            <h2>What you can do</h2>
            <div class="capabilities-grid">
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x1F50D;</div>
                    <h3>Permit Search &amp; Tracking</h3>
                    <p class="capability-desc">Search any SF address to see all building permits, current status, and inspection history.</p>
                    <div class="capability-data-point">1.1M+ permits indexed</div>
                    <span class="capability-badge capability-badge-free">Free</span>
                </div>
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x23F1;</div>
                    <h3>Timeline Estimation</h3>
                    <p class="capability-desc">AI-powered processing time predictions using station-sum velocity model and historical data.</p>
                    <div class="capability-data-point">Station-sum velocity model</div>
                    <span class="capability-badge capability-badge-free">Free</span>
                </div>
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x1F578;</div>
                    <h3>Entity Network</h3>
                    <p class="capability-desc">Discover contractors, architects, and engineers connected to any permit or property.</p>
                    <div class="capability-data-point">1M entities &middot; 576K edges</div>
                    <span class="capability-badge capability-badge-premium">Sign up free</span>
                </div>
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x1F4CB;</div>
                    <h3>AI Plan Analysis</h3>
                    <p class="capability-desc">Upload plan sets for AI-powered EPR compliance checks and review station routing predictions.</p>
                    <div class="capability-data-point">Claude Vision EPR checks</div>
                    <span class="capability-badge capability-badge-premium">Sign up free</span>
                </div>
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x1F4CA;</div>
                    <h3>Routing Intelligence</h3>
                    <p class="capability-desc">Track permit review progress through DBI, Planning, Fire, and 15+ agency review stations.</p>
                    <div class="capability-data-point">3.9M addenda records</div>
                    <span class="capability-badge capability-badge-premium">Sign up free</span>
                </div>
                <div class="glass-card capability-card">
                    <div class="capability-icon">&#x1F4E8;</div>
                    <h3>Morning Briefs</h3>
                    <p class="capability-desc">Daily email updates when your watched permits change status, get inspected, or hit milestones.</p>
                    <div class="capability-data-point">Daily severity scoring</div>
                    <span class="capability-badge capability-badge-premium">Sign up free</span>
                </div>
            </div>
        </div>
    </section>

    <!-- ── Stats Bar ─────────────────────────────────────────────────── -->
    <section class="stats-bar">
        <div class="obs-container">
            <div class="stats-bar-grid">
                <div class="stat-block">
                    <div class="stat-number" data-stat="permits">1.1M+</div>
                    <div class="stat-label">Permits tracked</div>
                </div>
                <div class="stat-block">
                    <div class="stat-number" data-stat="routing">3.9M+</div>
                    <div class="stat-label">Review records</div>
                </div>
                <div class="stat-block">
                    <div class="stat-number" data-stat="inspections">671K+</div>
                    <div class="stat-label">Inspections</div>
                </div>
                <div class="stat-block">
                    <div class="stat-number" data-stat="entities">1M+</div>
                    <div class="stat-label">Entities mapped</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ── Credibility Footer ────────────────────────────────────────── -->
    <section class="credibility-section">
        <div class="obs-container">
            <div class="credibility-grid">
                <div class="credibility-item">
                    <span class="cred-icon">&#x1F3DB;</span>
                    Built on 22 SF government data sources
                </div>
                <div class="credibility-item">
                    <span class="cred-icon">&#x2705;</span>
                    3,300+ automated tests
                </div>
                <div class="credibility-item">
                    <span class="cred-icon">&#x1F504;</span>
                    Updated nightly
                </div>
            </div>
        </div>
    </section>

    <!-- ── CTA Section ───────────────────────────────────────────────── -->
    <section class="cta-section">
        <div class="obs-container">
            <h2>Get more from your permit data</h2>
            <p class="cta-sub">Create a free account to unlock property reports, morning briefs, plan analysis, and your personal portfolio tracker.</p>
            <a href="/auth/login" class="obsidian-btn obsidian-btn-primary" style="font-size:var(--text-lg);padding:var(--space-4) var(--space-8);">Create free account</a>
            <div class="cta-features">
                <span>&#10003; No credit card</span>
                <span>&#10003; Watch up to 25 properties</span>
                <span>&#10003; Daily email briefs</span>
            </div>
        </div>
    </section>

    <!-- ── Footer ────────────────────────────────────────────────────── -->
    <footer class="landing-footer">
        <div class="obs-container">
            <p>Built on San Francisco open data. <a href="/health">System status</a></p>
        </div>
    </footer>

    <!-- ── Live Data Fetch (progressive enhancement) ─────────────────── -->
    <script nonce="{{ csp_nonce }}">
    (function() {
        fetch('/api/stats')
            .then(function(r) { return r.ok ? r.json() : null; })
            .then(function(data) {
                if (!data) return;
                var fmt = function(n) {
                    if (n >= 1000000) return (n / 1000000).toFixed(1).replace(/\.0$/, '') + 'M+';
                    if (n >= 1000) return Math.round(n / 1000).toLocaleString() + 'K+';
                    return n.toLocaleString();
                };
                var pulse = document.getElementById('data-pulse');
                if (pulse && data.permits) {
                    var els = pulse.querySelectorAll('[data-stat]');
                    els.forEach(function(el) {
                        var key = el.getAttribute('data-stat');
                        if (key === 'last_refresh' && data.last_refresh) {
                            el.textContent = 'Last refresh: ' + new Date(data.last_refresh).toLocaleDateString();
                        } else if (data[key]) {
                            el.textContent = fmt(data[key]);
                        }
                    });
                }
            })
            .catch(function() { /* Fallback numbers already in HTML */ });
    })();
    </script>
    <script nonce="{{ csp_nonce }}" src="/static/activity-tracker.js" defer></script>
    <!-- PostHog analytics (async, non-blocking) -->
    {% if posthog_key %}
    <script async nonce="{{ csp_nonce }}">
      !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
      posthog.init('{{ posthog_key }}', {api_host: '{{ posthog_host }}'});
    </script>
    {% endif %}
</body>
</html>
