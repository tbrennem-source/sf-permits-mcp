<div class="result-card search-result-card">
    <div class="search-echo" style="display: flex; justify-content: space-between; align-items: center;">
        <span>{{ query_echo }}</span>
        {% if watch_data %}
        <span class="watch-container">
            {% if existing_watch_id %}
            {% include 'fragments/watch_confirmation.html' %}
            {% elif g.user %}
            {% include 'fragments/watch_button.html' %}
            {% else %}
            {% include 'fragments/login_prompt.html' %}
            {% endif %}
        </span>
        {% endif %}
    </div>

    {# Quick Actions - appears at TOP before results #}
    {% if not no_results and (report_url or street_address) %}
    <div style="margin-top:16px;margin-bottom:16px;padding:16px;background:rgba(79, 143, 247, 0.06);border:1px solid rgba(79, 143, 247, 0.2);border-radius:10px;">
        <div style="font-weight: 600; margin-bottom: 12px; color: var(--text);">Quick Actions</div>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">

            <!-- Primary: View Property Report -->
            {% if report_url %}
            <a href="{{ report_url }}"
               style="display:inline-flex;align-items:center;gap:6px;padding:10px 20px;background:var(--accent, #4f8ff7);color:#fff;text-decoration:none;border-radius:8px;font-weight:600;font-size:0.9rem;">
                üìä View Property Report
            </a>
            {% endif %}

            <!-- Ask AI about this property -->
            {% if street_address %}
            <form method="POST" action="/ask" style="display: inline; margin: 0;">
                <input type="hidden" name="q" value="What permits are needed for work at {{ street_address }}?">
                <button type="submit"
                    style="display:inline-flex;align-items:center;gap:6px;padding:10px 20px;background:var(--surface);color:var(--accent);border:1px solid var(--accent);text-decoration:none;border-radius:8px;font-weight:600;font-size:0.9rem;cursor:pointer;font-family:inherit;">
                    üí¨ Ask AI
                </button>
            </form>
            {% endif %}

            <!-- Analyze Project (prefill with address) -->
            {% if street_address %}
            <form method="POST" action="/ask" style="display: inline; margin: 0;">
                <input type="hidden" name="q" value="I want to analyze a project at {{ street_address }}">
                <button type="submit"
                    style="display:inline-flex;align-items:center;gap:6px;padding:10px 20px;background:var(--surface);color:var(--text);border:1px solid var(--border);text-decoration:none;border-radius:8px;font-weight:600;font-size:0.9rem;cursor:pointer;font-family:inherit;">
                    üîç Analyze Project
                </button>
            </form>
            {% endif %}

            <!-- Search Violations at this address -->
            {% if street_address %}
            <form method="POST" action="/ask" style="display: inline; margin: 0;">
                <input type="hidden" name="q" value="Are there any violations at {{ street_address }}?">
                <button type="submit"
                    style="display:inline-flex;align-items:center;gap:6px;padding:10px 20px;background:var(--surface);color:var(--text);border:1px solid var(--border);text-decoration:none;border-radius:8px;font-weight:600;font-size:0.9rem;cursor:pointer;font-family:inherit;">
                    ‚ö†Ô∏è Check Violations
                </button>
            </form>
            {% endif %}

        </div>
    </div>
    {% endif %}

    {{ result_html | safe }}
    {% if no_results and no_results_address %}
    <div style="margin-top: 20px; padding: 20px; background: rgba(79, 143, 247, 0.06); border: 1px solid rgba(79, 143, 247, 0.2); border-radius: 10px;">
        <div style="font-weight: 600; margin-bottom: 8px;">What you can do next</div>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            {% if report_url %}
            <a href="{{ report_url }}"
               style="display: inline-flex; align-items: center; gap: 8px; color: #4f8ff7; text-decoration: none; font-weight: 600; font-size: 0.95rem;">
                <span style="font-size: 1.1rem;">&#x1F4CA;</span> Run Property Report
            </a>
            {% endif %}
            <form method="POST" action="/ask" style="display: inline; margin: 0; padding: 0;">
                <input type="hidden" name="q" value="What permits are needed for work at {{ no_results_address }}?">
                <button type="submit"
                    style="display: inline-flex; align-items: center; gap: 8px; color: #4f8ff7; text-decoration: none; font-size: 0.95rem; background: none; border: none; cursor: pointer; padding: 0; font-family: inherit;">
                    <span style="font-size: 1.1rem;">&#x1F4AC;</span> Ask AI about permits for this address
                </button>
            </form>
            <a href="/?q={{ no_results_address }}"
               style="display: inline-flex; align-items: center; gap: 8px; color: #8b8fa3; text-decoration: none; font-size: 0.9rem;">
                <span style="font-size: 1.1rem;">&#x1F50D;</span> Try a different search
            </a>
            <span style="color: #8b8fa3; font-size: 0.85rem; margin-top: 4px;">
                No permit history doesn't mean no permits are required &mdash; it may just mean no permits have been filed yet at this address.
            </span>
        </div>
    </div>
    {% endif %}
    {% if show_primary_prompt and prompt_street_number %}
    {% include 'fragments/primary_address_prompt.html' %}
    {% endif %}
</div>
