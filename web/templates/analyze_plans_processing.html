<style>
    .processing-card {
        text-align: center;
        padding: 48px 24px;
        max-width: 600px;
        margin: 0 auto;
    }

    .processing-spinner {
        font-size: 3rem;
        animation: pulse-spin 2s ease-in-out infinite;
        margin-bottom: 20px;
    }

    @keyframes pulse-spin {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.1); }
    }

    .processing-card h2 {
        font-size: 1.3rem;
        margin: 0 0 8px;
        color: var(--accent, #2563eb);
    }

    .processing-card .file-info {
        color: var(--text-muted, #999);
        font-size: 0.9rem;
        margin-bottom: 20px;
    }

    .processing-card .message {
        color: var(--text-muted, #999);
        font-size: 0.9rem;
        line-height: 1.5;
        max-width: 420px;
        margin: 0 auto 24px;
    }

    .processing-tip {
        margin-top: 24px;
        padding: 16px;
        background: var(--surface-2, #333);
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--text-muted, #999);
        max-width: 420px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Step indicator (initial state â€” matches polling template) */
    .step-indicator { display: flex; align-items: center; justify-content: center; gap: 0; max-width: 400px; margin: 0 auto 16px; }
    .step-dot {
        width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--border, #333); background: transparent;
        flex-shrink: 0; transition: all 0.3s;
    }
    .step-dot.active { border-color: var(--accent, #2563eb); background: var(--accent, #2563eb); animation: step-pulse 1.5s ease-in-out infinite; }
    .step-line { flex: 1; height: 2px; background: var(--border, #333); }
    .step-label { font-size: 0.75rem; color: var(--text-muted, #999); margin-top: 6px; text-align: center; }
    .step-label.active { color: var(--accent, #2563eb); font-weight: 600; }
    .step-group { display: flex; flex-direction: column; align-items: center; min-width: 70px; }
    .step-detail { font-size: 0.85rem; color: var(--text-muted, #999); text-align: center; margin-top: 4px; }
    @keyframes step-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
        50% { box-shadow: 0 0 0 6px rgba(37, 99, 235, 0); }
    }
</style>

<div class="result-card processing-card">
    <div class="processing-spinner">&#9203;</div>
    <h2>Processing Your Plan Set</h2>
    <div class="file-info">
        <strong>{{ filename }}</strong> &mdash; {{ filesize_mb }} MB
    </div>
    <div class="message">
        Large plan sets are analyzed in the background.
        {% if user_email %}
        We'll email <strong>{{ user_email }}</strong> when your analysis is ready.
        {% else %}
        Stay on this page to see results when ready.
        {% endif %}
    </div>

    <!-- HTMX polls job status every 3 seconds -->
    <div hx-get="/plan-jobs/{{ job_id }}/status"
         hx-trigger="every 3s"
         hx-swap="outerHTML"
         id="job-status-poll">

        <div class="step-indicator">
            <div class="step-group">
                <div class="step-dot active"></div>
                <div class="step-label active">Analyzing</div>
            </div>
            <div class="step-line"></div>
            <div class="step-group">
                <div class="step-dot"></div>
                <div class="step-label">Rendering</div>
            </div>
            <div class="step-line"></div>
            <div class="step-group">
                <div class="step-dot"></div>
                <div class="step-label">Finalizing</div>
            </div>
        </div>

        <div class="step-detail">Preparing analysis...</div>
    </div>

    <div class="processing-tip">
        {% if user_email %}
        &#128161; You can close this page &mdash; we'll email you when it's done.
        {% else %}
        &#128161; <a href="/auth/login" style="color: var(--accent);">Sign in</a> to receive email notifications for future analyses.
        {% endif %}
    </div>
</div>
