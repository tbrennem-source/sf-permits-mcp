<style>
    .processing-card {
        text-align: center;
        padding: 48px 24px;
        max-width: 600px;
        margin: 0 auto;
    }

    .processing-spinner {
        font-size: 3rem;
        animation: pulse-spin 2s ease-in-out infinite;
        margin-bottom: 20px;
    }

    @keyframes pulse-spin {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.1); }
    }

    .processing-card h2 {
        font-size: 1.3rem;
        margin: 0 0 8px;
        color: var(--accent, #2563eb);
    }

    .processing-card .file-info {
        color: var(--text-muted, #999);
        font-size: 0.9rem;
        margin-bottom: 20px;
    }

    .processing-card .message {
        color: var(--text-muted, #999);
        font-size: 0.9rem;
        line-height: 1.5;
        max-width: 420px;
        margin: 0 auto 24px;
    }

    .processing-progress {
        max-width: 400px;
        margin: 0 auto 16px;
        height: 6px;
        background: var(--surface-2, #333);
        border-radius: 3px;
        overflow: hidden;
    }

    .processing-progress-bar {
        height: 100%;
        width: 30%;
        background: var(--accent, #2563eb);
        border-radius: 3px;
        animation: progress-slide 2s ease-in-out infinite;
    }

    @keyframes progress-slide {
        0% { transform: translateX(-100%); width: 30%; }
        50% { transform: translateX(100%); width: 60%; }
        100% { transform: translateX(300%); width: 30%; }
    }

    .processing-status {
        font-size: 0.85rem;
        color: var(--text-muted, #999);
    }

    .processing-tip {
        margin-top: 24px;
        padding: 16px;
        background: var(--surface-2, #333);
        border-radius: 8px;
        font-size: 0.85rem;
        color: var(--text-muted, #999);
        max-width: 420px;
        margin-left: auto;
        margin-right: auto;
    }
</style>

<div class="result-card processing-card">
    <div class="processing-spinner">&#9203;</div>
    <h2>Processing Your Plan Set</h2>
    <div class="file-info">
        <strong>{{ filename }}</strong> &mdash; {{ filesize_mb }} MB
    </div>
    <div class="message">
        Large plan sets are analyzed in the background.
        {% if user_email %}
        We'll email <strong>{{ user_email }}</strong> when your analysis is ready.
        {% else %}
        Stay on this page to see results when ready.
        {% endif %}
    </div>

    <!-- HTMX polls job status every 3 seconds -->
    <div hx-get="/plan-jobs/{{ job_id }}/status"
         hx-trigger="every 3s"
         hx-swap="outerHTML"
         id="job-status-poll">
        <div class="processing-progress">
            <div class="processing-progress-bar"></div>
        </div>
        <div class="processing-status">Status: Processing...</div>
    </div>

    <div class="processing-tip">
        {% if user_email %}
        &#128161; You can close this page &mdash; we'll email you when it's done.
        {% else %}
        &#128161; <a href="/login" style="color: var(--accent);">Sign in</a> to receive email notifications for future analyses.
        {% endif %}
    </div>
</div>
