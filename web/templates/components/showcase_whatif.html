{# showcase_whatif.html — What-If Scenario Comparison (visual-first redesign) #}
{# Receives: showcase.whatif (via Jinja2 global from routes_public.py) #}
{% set whatif = showcase.whatif if showcase else None %}
{% if whatif and whatif.scenario_a and whatif.scenario_b %}
{% set a = whatif.scenario_a %}
{% set b = whatif.scenario_b %}
<div class="showcase-card showcase-whatif"
     data-track="showcase-view"
     data-showcase="whatif">
  <style>
    /* Intel label */
    .whatif-intel-label {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      color: var(--text-tertiary);
      padding: var(--space-4) var(--space-5) 0;
      margin-bottom: var(--space-3);
    }

    /* Two-column comparison */
    .whatif-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-3);
      padding: 0 var(--space-5) var(--space-4);
    }
    .whatif-col {
      border-radius: var(--radius-sm);
      padding: var(--space-4);
    }
    .whatif-col--a {
      background: rgba(52, 211, 153, 0.06);
      border: 1px solid rgba(52, 211, 153, 0.16);
    }
    .whatif-col--b {
      background: rgba(251, 191, 36, 0.06);
      border: 1px solid rgba(251, 191, 36, 0.16);
    }

    /* Scenario label */
    .whatif-scenario-label {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 400;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: var(--space-2);
    }
    .whatif-col--a .whatif-scenario-label { color: var(--signal-green); }
    .whatif-col--b .whatif-scenario-label { color: var(--signal-amber); }

    /* Big timeline number */
    .whatif-timeline {
      font-family: var(--mono);
      font-size: clamp(1.6rem, 3vw, 2.1rem);
      font-weight: 300;
      line-height: 1;
      margin-bottom: var(--space-2);
    }
    .whatif-col--a .whatif-timeline { color: var(--signal-green); }
    .whatif-col--b .whatif-timeline { color: var(--signal-amber); }

    /* Sub-stats row */
    .whatif-sub {
      font-family: var(--mono);
      font-size: var(--text-xs);
      color: var(--text-secondary);
    }

    /* Timeline progress bar */
    .whatif-bar-wrap {
      height: 3px;
      background: var(--glass-border);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-top: var(--space-3);
    }
    .whatif-bar-fill {
      height: 100%;
      border-radius: var(--radius-full);
    }
    .whatif-bar-fill--a { background: var(--signal-green); }
    .whatif-bar-fill--b { background: var(--dot-amber); }

    /* Delta row */
    .whatif-delta-row {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: 0 var(--space-5) var(--space-3);
      flex-wrap: wrap;
    }
    .whatif-delta-chip {
      font-family: var(--mono);
      font-size: 10px;
      color: var(--signal-amber);
      background: rgba(251, 191, 36, 0.08);
      border: 1px solid rgba(251, 191, 36, 0.18);
      border-radius: var(--radius-sm);
      padding: 3px 8px;
    }
    .whatif-strategy {
      font-family: var(--sans);
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      flex: 1;
      min-width: 0;
    }

    /* Review path badges */
    .whatif-path-badge {
      display: inline-block;
      font-family: var(--mono);
      font-size: 10px;
      border-radius: var(--radius-sm);
      padding: 2px 6px;
      margin-top: var(--space-2);
    }
    .whatif-path-badge--otc {
      background: rgba(52, 211, 153, 0.10);
      border: 1px solid rgba(52, 211, 153, 0.20);
      color: var(--signal-green);
    }
    .whatif-path-badge--inhouse {
      background: rgba(251, 191, 36, 0.08);
      border: 1px solid rgba(251, 191, 36, 0.18);
      color: var(--signal-amber);
    }

    /* Footer */
    .whatif-footer {
      padding: var(--space-3) var(--space-5) var(--space-4);
      border-top: 1px solid var(--glass-border);
      display: flex;
      justify-content: flex-end;
    }

    @media (max-width: 420px) {
      .whatif-grid { grid-template-columns: 1fr; }
    }
  </style>

  <div class="whatif-intel-label">Simulation Intelligence</div>

  {# Two scenario columns #}
  <div class="whatif-grid">
    {# Scenario A — OTC / fast path #}
    <div class="whatif-col whatif-col--a">
      <div class="whatif-scenario-label">{{ a.label }}</div>
      <div class="whatif-timeline">{{ a.timeline_p50 }}</div>
      <div class="whatif-sub">{{ a.fees }} · {{ a.agencies }}</div>
      {% if a.review_path %}
      <span class="whatif-path-badge whatif-path-badge--otc">{{ a.review_path }}</span>
      {% endif %}
      <div class="whatif-bar-wrap">
        {# A is the shorter path — calculate bar % relative to B p50 #}
        {% set a_days = a.p50_days | int %}
        {% set b_days = b.p50_days | int %}
        {% set a_pct = ((a_days / b_days) * 100) | round | int if b_days > 0 else 20 %}
        <div class="whatif-bar-fill whatif-bar-fill--a" style="width: {{ [a_pct, 12] | max }}%;"></div>
      </div>
    </div>

    {# Scenario B — in-house / complex path #}
    <div class="whatif-col whatif-col--b">
      <div class="whatif-scenario-label">{{ b.label }}</div>
      <div class="whatif-timeline">{{ b.timeline_p50 }}</div>
      <div class="whatif-sub">{{ b.fees }} · {{ b.agencies }}</div>
      {% if b.review_path %}
      <span class="whatif-path-badge whatif-path-badge--inhouse">{{ b.review_path }}</span>
      {% endif %}
      <div class="whatif-bar-wrap">
        <div class="whatif-bar-fill whatif-bar-fill--b" style="width: 100%;"></div>
      </div>
    </div>
  </div>

  {# Delta chips from comparison data #}
  {% if whatif.comparison %}
  <div class="whatif-delta-row">
    {% for row in whatif.comparison %}
    {% if row.verdict == 'a_wins' and row.delta and loop.index <= 3 %}
    <span class="whatif-delta-chip">+{{ row.delta }}</span>
    {% endif %}
    {% endfor %}
    {% if whatif.strategy %}
    <span class="whatif-strategy">{{ whatif.strategy | truncate(60, True, '…') }}</span>
    {% endif %}
  </div>
  {% endif %}

  <div class="whatif-footer">
    <a href="/tools/what-if?demo=kitchen-vs-full"
       class="showcase-card__cta"
       data-track="showcase-click"
       data-showcase="whatif">Compare your project →</a>
  </div>
</div>
{% else %}
<div class="showcase-card" style="padding: var(--space-6);">
  <div style="font-family: var(--mono); font-size: var(--text-sm); color: var(--text-tertiary); font-style: italic;">
    Scenario data unavailable
  </div>
</div>
{% endif %}
